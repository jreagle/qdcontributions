name: qdContributionsAPI

on:
  workflow_dispatch:

jobs:
  list-issues:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/github-script@v7
        with:
          script: |
            const query = `query searchContributions($q: String!) {
              search(query: $q, type:ISSUE, first: 50) {
                codeCount
                issueCount
                edges {
                  node {
                    ... on Issue {
                      number
                      title
                      createdAt
                      url
                      state
                    }
                    ... on PullRequest {
                      number
                      title
                      createdAt
                      url
                      state
                      }
                    }
                  }
                }
              }`;
            const variables = {
              q: 'mt_cotriguacu repo:okfn-brasil/querido-diario',
            }
            return await github.graphql(query, variables)

      - name: Get result
        run: echo "${{steps.set-result.outputs.result}}"
            
      - name: Edit Json
        shell: bash
        run: |
          echo $(jq --arg a "${{ steps.set-result.outputs.result }}" '.cities.level = ($a)' ./api/ro/${{ matrix.codarea }}.json) > ./api/ro/${{ matrix.codarea }}.json  

      - uses: actions/upload-artifact@v4
        with:
          name: my-test-file
          path: ./api/ro/${{ matrix.codarea }}.json
